

# üìò Firebase Setup ‚Äì M√≥dulo de Constancias de Examen

Este documento gu√≠a paso a paso la configuraci√≥n de Firebase para utilizarlo como backend de datos y almacenamiento de archivos PDF en el m√≥dulo "Constancias de Examen" de Gibbon.

---

## ‚úÖ Requisitos

* Cuenta de Google
* Proyecto en Firebase Console: [https://console.firebase.google.com](https://console.firebase.google.com)
* Acceso a Google Cloud Console: [https://console.cloud.google.com](https://console.cloud.google.com)

---

## 1Ô∏è‚É£ Crear el proyecto en Firebase

1. Ir a [https://console.firebase.google.com](https://console.firebase.google.com)
2. Hacer clic en **"Agregar proyecto"**
3. Elegir un nombre (ej. `gibbon-constancias`)
4. Desactivar Google Analytics (opcional)
5. Completar la creaci√≥n

---

## 2Ô∏è‚É£ Activar Firestore

1. En el men√∫ izquierdo, ir a **Firestore Database**
2. Hacer clic en **"Crear base de datos"**
3. Elegir **Modo producci√≥n**
4. Seleccionar una regi√≥n (ej. `us-central1` o cercana)

---

## 3Ô∏è‚É£ Activar Firebase Storage

> ‚ö†Ô∏è Para usar Storage, es necesario actualizar al **plan Blaze** (ingresar tarjeta de cr√©dito, no se cobra si no se supera el l√≠mite gratuito).

1. Ir a **Storage** en el men√∫
2. Hacer clic en **"Empezar"**
3. Elegir la **misma regi√≥n** que Firestore (`us-central1`, por ejemplo)
4. Se crear√° un bucket con el nombre:
   `gs://<project-id>.appspot.com`

---

## 4Ô∏è‚É£ Crear colecci√≥n `constancias` en Firestore

Cada documento representa un pedido de constancia.

### üìÑ Estructura del documento

```json
{
  "idAlumno": "12345678",
  "nombre": "Juan P√©rez",
  "email": "juan@mail.com",
  "estado": "pendiente",
  "fechaPedido": <timestamp>,
  "pdfUrl": null,
  "examen": {
    "materia": "Matem√°tica I",
    "fechaExamen": <timestamp>
  }
}
```

> El ID del documento generado autom√°ticamente se utiliza como `idPedido`.

---

## 5Ô∏è‚É£ Crear √≠ndice compuesto

1. Ir a **Firestore > √çndices**
2. Hacer clic en **"Crear √≠ndice compuesto"**
3. En **colecci√≥n**: `constancias`
4. Ordenar por:

   * `idAlumno`: ascendente
   * `fechaPedido`: descendente
   * `__name__`: descendente (opcional para optimizaci√≥n de queries)
5. Guardar el √≠ndice

---

## 6Ô∏è‚É£ Configurar reglas de seguridad (modo desarrollo)

### üîê Firestore

```js
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /constancias/{docId} {
      allow read, write: if true; // ‚ö†Ô∏è Abierto solo para pruebas
    }
  }
}
```

### üîê Storage

```js
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /constancias/{allPaths=**} {
      allow read, write: if true; // ‚ö†Ô∏è Abierto solo para pruebas
    }
  }
}
```

> Estas reglas deben **restringirse en producci√≥n** para evitar acceso p√∫blico no autorizado.

---

## 7Ô∏è‚É£ Crear cuenta de servicio para integraci√≥n con PHP

1. Ir a: [https://console.cloud.google.com/iam-admin/serviceaccounts](https://console.cloud.google.com/iam-admin/serviceaccounts)
2. Crear cuenta:

   * Nombre: `gibbon-firebase-service`
3. Asignar roles:

   * Firebase Admin
   * Storage Admin
   * Cloud Datastore User
4. Crear clave privada (formato JSON)
5. Guardar el archivo como:
   `firebase-creds.json`

---

## 8Ô∏è‚É£ Estructura de Firebase Storage

No se crean carpetas manualmente. Los archivos se suben con una ruta tipo:

```
constancias/{idAlumno}/{fecha}-materia.pdf
```

Ejemplo:

```
constancias/12345678/2025-06-18-matematica-i.pdf
```

---

## 9Ô∏è‚É£ Librer√≠as necesarias en PHP

Instalar las librer√≠as oficiales de Google:

```bash
composer require google/cloud-firestore google/cloud-storage
```

---

## üîö Listo para integraci√≥n

Una vez completados estos pasos, Firebase queda listo para integrarse con el m√≥dulo de Gibbon.
Se podr√° subir archivos PDF desde el panel de administraci√≥n, almacenarlos en Storage y vincular su URL a los documentos de Firestore.
